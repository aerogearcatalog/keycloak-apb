FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IHJlcXVpcmVkCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogS2V5Y2xvYWsKICBpbWFnZVVybDog\
Imh0dHBzOi8vcGJzLnR3aW1nLmNvbS9wcm9maWxlX2ltYWdlcy83MDIxMTk4MjE5NzkzNDQ4OTcv\
b0FDMDVjRUJfNDAweDQwMC5wbmciCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHA6Ly93d3cua2V5\
Y2xvYWsub3JnL2RvY3VtZW50YXRpb24uaHRtbCIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVk\
IEhhdCwgSW5jLiIKICBkZXBlbmRlbmNpZXM6CiAgICAtICJkb2NrZXIuaW8vamJvc3Mva2V5Y2xv\
YWstb3BlbnNoaWZ0OjMuNC4zLkZpbmFsIgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jl\
c3FsLTk2LWNlbnRvczc6OS42IgogIHNkay1kb2NzLWFuZHJvaWQ6ICJodHRwczovL2dpdGh1Yi5j\
b20vYWVyb2dlYXJjYXRhbG9nL2tleWNsb2FrLWFwYiIKICBzZGstZG9jcy1jb3Jkb3ZhOiAiaHR0\
cHM6Ly9naXRodWIuY29tL2Flcm9nZWFyY2F0YWxvZy9rZXljbG9hay1hcGIiCiAgc2RrLWRvY3Mt\
aW9zOiAiaHR0cHM6Ly9naXRodWIuY29tL2Flcm9nZWFyY2F0YWxvZy9rZXljbG9hay1hcGIiCiAg\
c2RrLWRvY3MteGFtYXJpbjogImh0dHBzOi8vZ2l0aHViLmNvbS9hZXJvZ2VhcmNhdGFsb2cva2V5\
Y2xvYWstYXBiIgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5hbWU6IGRlZmF1\
bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRydWUKICAgIG1l\
dGFkYXRhOgogICAgICBtb2JpbGVjbGllbnRfYmluZF9wYXJhbWV0ZXJzX2RhdGE6CiAgICAgICAg\
LSAneyJuYW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1lIiwgInR5cGUi\
OiAicGF0aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2YWx1ZSI6ICJw\
dWJsaWMiLCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICAgIHNlcnZpY2VpbnN0YW5jZV9iaW5kX3Bh\
cmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwgInZhbHVlIjog\
Im1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICAgICAgLSAneyJuYW1lIjogIkNM\
SUVOVF9UWVBFIiwgInZhbHVlIjogImJlYXJlciIsICJ0eXBlIjogImRlZmF1bHQifScKICAgIHBh\
cmFtZXRlcnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1aXJlZDogVHJ1\
ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtl\
eWNsb2FrIGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJl\
cXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JFQUxN\
X05BTUUKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogTmFtZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNw\
YWNlKQogICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZhbHNl\
CiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcgc2hh\
cmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZhbHNl\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2Vydmlj\
ZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBDTElFTlRfSUQKICAgICAgcmVxdWly\
ZWQ6IFRydWUKICAgICAgdGl0bGU6IE1vYmlsZSBjbGllbnQgSUQvU2VydmljZSBJRAogICAgICB0\
eXBlOiBzdHJpbmcKICAgIC0gbmFtZTogQ0xJRU5UX1RZUEUKICAgICAgcmVxdWlyZWQ6IFRydWUK\
ICAgICAgdGl0bGU6IEtleWNsb2FrIGNsaWVudCB0eXBlCiAgICAgIHR5cGU6IGVudW0KICAgICAg\
ZW51bTogWydiZWFyZXInLCAncHVibGljJ10KICAgICAgZGVmYXVsdDogcHVibGljCg=="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb