FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IHJlcXVpcmVkCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogS2V5ZmdqZmp0cmpqaGNsb2FrCiAg\
aW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5ODIx\
OTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRw\
Oi8vd3d3LmtleWNsb2FrLm9yZy9kb2N1bWVudGF0aW9uLmh0bWwiCiAgcHJvdmlkZXJEaXNwbGF5\
TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlvL2pi\
b3NzL2tleWNsb2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIKICAgIC0gImRvY2tlci5pby9jZW50\
b3MvcG9zdGdyZXNxbC05Ni1jZW50b3M3OjkuNiIKICBzZXJ2aWNlTmFtZToga2V5Y2xvYWsKcGxh\
bnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVwbG95IGtleWNsb2FrCiAg\
ICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6IAogICAgLSBuYW1l\
OiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1p\
bgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2FrIGFkbWluIHVzZXJuYW1l\
CiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRl\
ZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogS2V5Y2xvYWsgYWRt\
aW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JFQUxNX05BTUUKICAgICAgcmVxdWlyZWQ6\
IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2V5Y2xv\
YWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNwYWNlKQogICAgLSBuYW1lOiBVU0Vf\
U0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IGJvb2wKICAg\
ICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcgc2hhcmVkIHNlcnZpY2UKICAgIC0gbmFt\
ZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2VydmljZQogICAgYmluZF9wYXJhbWV0ZXJz\
OgogICAgLSBuYW1lOiBDTElFTlRfTkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICB0aXRs\
ZTogU2VydmljZSBuYW1lIG9yIENsaWVudCBJRAogICAgICB0eXBlOiBzdHJpbmcKICAgIC0gbmFt\
ZTogQ0xJRU5UX1RZUEUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgdGl0bGU6IEtleWNsb2Fr\
IGNsaWVudCB0eXBlCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydiZWFyZXInLCAncHVi\
bGljJ10KICAgICAgZGVmYXVsdDogJ3B1YmxpYycK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb