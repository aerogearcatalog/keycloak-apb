FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBB\
RVJPR0VBUi0yMjM1CmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOiAKICAtIG1v\
YmlsZS1zZXJ2aWNlCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBLZXljbG9hawogIGltYWdlVXJs\
OiAiaHR0cHM6Ly9wYnMudHdpbWcuY29tL3Byb2ZpbGVfaW1hZ2VzLzcwMjExOTgyMTk3OTM0NDg5\
Ny9vQUMwNWNFQl80MDB4NDAwLnBuZyIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cDovL3d3dy5r\
ZXljbG9hay5vcmcvZG9jdW1lbnRhdGlvbi5odG1sIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczogWydQb3N0Z3Jlc3FsOjkuNSddCiAgc2Vydmlj\
ZU5hbWU6IGtleWNsb2FrCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246\
IERlcGxveSBrZXljbG9hawogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOiAKICAgIC0gbmFtZTogQURNSU5fTkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAg\
ICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2Fr\
IGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJlcXVpcmVk\
OiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JFQUxNX05BTUUK\
ICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogTmFt\
ZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNwYWNlKQog\
ICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAg\
IHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcgc2hhcmVkIHNl\
cnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAg\
IHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2VydmljZQogICAg\
YmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBzZXJ2aWNlCiAgICAgIHJlcXVpcmVkOiBUcnVl\
CiAgICAgIHRpdGxlOiBUaGUgc2VydmljZSB0aGUgY2xpZW50IGlzIGZvcgogICAgICB0eXBlOiBz\
dHJpbmcKICAgIC0gbmFtZTogUkVBTE1fTkFNRQogICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2V5\
Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hbWVzcGFjZSkKICAgICAgdHlw\
ZTogc3RyaW5nCg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb