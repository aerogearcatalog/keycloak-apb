FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogSWRlbnRpdHkgTWFu\
YWdlbWVudCAtIElkZW50aXR5IGFuZCBBY2Nlc3MgTWFuYWdlbWVudApiaW5kYWJsZTogVHJ1ZQph\
c3luYzogcmVxdWlyZWQKdGFnczogCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVu\
dC1lbmFibGVkCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiAxLiBJZGVudGl0eSBNYW5hZ2VtZW50\
CiAgaW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5\
ODIxOTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJo\
dHRwczovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9rZXljbG9hay5odG1sIgogIHBy\
b3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczoKICAgIC0g\
ImRvY2tlci5pby9qYm9zcy9rZXljbG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJk\
b2NrZXIuaW8vY2VudG9zL3Bvc3RncmVzcWwtOTYtY2VudG9zNzo5LjYiCiAgc2RrLWRvY3MtYW5k\
cm9pZDogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL2lkbS9hbmRyb2lk\
Lmh0bWwiCiAgc2RrLWRvY3MtY29yZG92YTogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0\
ZXJuYWwvYXBiL2lkbS9jb3Jkb3ZhLmh0bWwiCiAgc2RrLWRvY3MtaW9zOiAiaHR0cHM6Ly9kb2Nz\
LmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvaWRtL2lvcy5odG1sIgogIHNkay1kb2NzLXhhbWFy\
aW46ICJodHRwczovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9pZG0veGFtYXJpbi5o\
dG1sIgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAg\
IGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRh\
OgogICAgICBtb2JpbGVjbGllbnRfYmluZF9wYXJhbWV0ZXJzX2RhdGE6CiAgICAgICAgLSAneyJu\
YW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1lIiwgInR5cGUiOiAicGF0\
aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2YWx1ZSI6ICJwdWJsaWMi\
LCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICAgIHNlcnZpY2VpbnN0YW5jZV9iaW5kX3BhcmFtZXRl\
cnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwgInZhbHVlIjogIm1ldGFk\
YXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9U\
WVBFIiwgInZhbHVlIjogImJlYXJlciIsICJ0eXBlIjogImRlZmF1bHQifScKICAgIHBhcmFtZXRl\
cnM6IAogICAgLSBuYW1lOiBBUFBMSUNBVElPTl9OQU1FCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAg\
ICAgIGRlZmF1bHQ6IGtleWNsb2FrCiAgICAgIHBhdHRlcm46ICJbYS16XShbLWEtejAtOV0qW2Et\
ejAtOV0pPyIKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9hayBhcHBsaWNh\
dGlvbiBuYW1lLCBldmVyeSBkZXBsb3llZCBpbnN0YW5jZSBpbiB0aGUgc2FtZSBuYW1lc3BhY2Ug\
bmVlZHMgdG8gaGF2ZSB1bmlxdWUgbmFtZS4KICAgIC0gbmFtZTogSFRUUFNfU0VDUkVUCiAgICAg\
IHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IHNzby1hcHAtc2VjcmV0CiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICB0aXRsZTogVGhlIG5hbWUgb2YgdGhlIHNlY3JldCB0byB1c2UgdG8gZXhw\
b3NlIFJILVNTTy9LZXljbG9hayBvdmVyIEhUVFBTLgogICAgLSBuYW1lOiBIVFRQU19LRVlTVE9S\
RQogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBrZXlzdG9yZS5qa3MKICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBUaGUgbmFtZSBvZiB0aGUga2V5c3RvcmUgdG8gdXNl\
IHRvIGV4cG9zZSBSSC1TU08vS2V5Y2xvYWsgb3ZlciBIVFRQUy4KICAgIC0gbmFtZTogSFRUUFNf\
TkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBqYm9zcwogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgdGl0bGU6IFRoZSBhbGlhcyBvZiB0aGUga2V5cy9jZXJ0aWZpY2F0ZSB0\
byB1c2UgdG8gZXhwb3NlIFJILVNTTy9LZXljbG9hayBvdmVyIEhUVFBTLiAKICAgIC0gbmFtZTog\
SFRUUFNfUEFTU1dPUkQKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgZGVmYXVsdDogbXlrZXlz\
dG9yZXBhc3MKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBUaGUgcGFzc3dvcmQgb2Yg\
dGhlIGtleXN0b3JlIHRvIHVzZSB0byBleHBvc2UgUkgtU1NPL0tleWNsb2FrIG92ZXIgSFRUUFMu\
IAoKICAgIC0gbmFtZTogQURNSU5fVVNFUk5BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAg\
ZGVmYXVsdDogYWRtaW4KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9hayBh\
ZG1pbiB1c2VybmFtZQogICAgLSBuYW1lOiBBRE1JTl9QQVNTV09SRAogICAgICByZXF1aXJlZDog\
VHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6\
IEtleWNsb2FrIGFkbWluIHBhc3N3b3JkCiAgICAtIG5hbWU6IENVU1RPTV9SRUFMTV9OQU1FCiAg\
ICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUg\
b2YgdGhlIEtleWNsb2FrIHJlYWxtIChkZWZhdWx0cyB0byBjdXJyZW50IG5hbWVzcGFjZSkKICAg\
IC0gbmFtZTogVVNFX1NIQVJFRF9TRVJWSUNFCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0\
eXBlOiBib29sCiAgICAgIHRpdGxlOiBDb25uZWN0IHRvIGFuIGV4aXN0aW5nIHNoYXJlZCBzZXJ2\
aWNlCiAgICAtIG5hbWU6IFNIQVJFRF9IT1NUCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVSTCBvZiB0aGUgc2hhcmVkIHNlcnZpY2UKICAgIGJp\
bmRfcGFyYW1ldGVyczoKICAgIC0gbmFtZTogQ0xJRU5UX0lECiAgICAgIHJlcXVpcmVkOiBUcnVl\
CiAgICAgIHRpdGxlOiBNb2JpbGUgY2xpZW50IElEL1NlcnZpY2UgSUQKICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAtIG5hbWU6IENMSUVOVF9UWVBFCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIHRp\
dGxlOiBLZXljbG9hayBjbGllbnQgdHlwZQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsn\
YmVhcmVyJywgJ3B1YmxpYyddCiAgICAgIGRlZmF1bHQ6IHB1YmxpYwo="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb