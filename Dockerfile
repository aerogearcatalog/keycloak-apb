FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogSWRlbnRpdHkgTWFu\
YWdlbWVudCAtIElkZW50aXR5IGFuZCBBY2Nlc3MgTWFuYWdlbWVudApiaW5kYWJsZTogVHJ1ZQph\
c3luYzogcmVxdWlyZWQKdGFnczogCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVu\
dC1lbmFibGVkCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiAxMS5JZGVudGl0eSBNYW5hZ2VtZW50\
CiAgaW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5\
ODIxOTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJo\
dHRwczovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9rZXljbG9hay5odG1sIgogIHBy\
b3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczoKICAgIC0g\
ImRvY2tlci5pby9qYm9zcy9rZXljbG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJk\
b2NrZXIuaW8vY2VudG9zL3Bvc3RncmVzcWwtOTYtY2VudG9zNzo5LjYiCiAgc2RrLWRvY3MtYW5k\
cm9pZDogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL2lkbS9hbmRyb2lk\
Lmh0bWwiCiAgc2RrLWRvY3MtY29yZG92YTogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0\
ZXJuYWwvYXBiL2lkbS9jb3Jkb3ZhLmh0bWwiCiAgc2RrLWRvY3MtaW9zOiAiaHR0cHM6Ly9kb2Nz\
LmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvaWRtL2lvcy5odG1sIgogIHNkay1kb2NzLXhhbWFy\
aW46ICJodHRwczovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9pZG0veGFtYXJpbi5o\
dG1sIgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAg\
IGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRh\
OgogICAgICBtb2JpbGVjbGllbnRfYmluZF9wYXJhbWV0ZXJzX2RhdGE6CiAgICAgICAgLSAneyJu\
YW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1lIiwgInR5cGUiOiAicGF0\
aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2YWx1ZSI6ICJwdWJsaWMi\
LCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICAgIHNlcnZpY2VpbnN0YW5jZV9iaW5kX3BhcmFtZXRl\
cnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwgInZhbHVlIjogIm1ldGFk\
YXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9U\
WVBFIiwgInZhbHVlIjogImJlYXJlciIsICJ0eXBlIjogImRlZmF1bHQifScKICAgIHBhcmFtZXRl\
cnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAg\
ICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2Fr\
IGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJlcXVpcmVk\
OiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JFQUxNX05BTUUK\
ICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogTmFt\
ZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNwYWNlKQog\
ICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAg\
IHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcgc2hhcmVkIHNl\
cnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAg\
IHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2VydmljZQogICAg\
YmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBDTElFTlRfSUQKICAgICAgcmVxdWlyZWQ6IFRy\
dWUKICAgICAgdGl0bGU6IE1vYmlsZSBjbGllbnQgSUQvU2VydmljZSBJRAogICAgICB0eXBlOiBz\
dHJpbmcKICAgIC0gbmFtZTogQ0xJRU5UX1RZUEUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAg\
dGl0bGU6IEtleWNsb2FrIGNsaWVudCB0eXBlCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTog\
WydiZWFyZXInLCAncHVibGljJ10KICAgICAgZGVmYXVsdDogcHVibGljCg=="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb