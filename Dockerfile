FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IG9wdGlvbmFsCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogS2V5Y2xvYWsgdGVzdAogIGltYWdl\
VXJsOiAiaHR0cHM6Ly9wYnMudHdpbWcuY29tL3Byb2ZpbGVfaW1hZ2VzLzcwMjExOTgyMTk3OTM0\
NDg5Ny9vQUMwNWNFQl80MDB4NDAwLnBuZyIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cDovL3d3\
dy5rZXljbG9hay5vcmcvZG9jdW1lbnRhdGlvbi5odG1sIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6\
ICJSZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczoKICAgIC0gImRvY2tlci5pby9qYm9zcy9r\
ZXljbG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJkb2NrZXIuaW8vY2VudG9zL3Bv\
c3RncmVzcWwtOTYtY2VudG9zNzo5LjYiCiAgc2VydmljZU5hbWU6IGtleWNsb2FrCnBsYW5zOgog\
IC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlcGxveSBrZXljbG9hawogICAgZnJl\
ZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOiAKICAgIC0gbmFtZTogQURN\
SU5fVVNFUk5BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgZGVmYXVsdDogYWRtaW4KICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9hayBhZG1pbiB1c2VybmFtZQogICAg\
LSBuYW1lOiBBRE1JTl9QQVNTV09SRAogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0\
OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2FrIGFkbWluIHBh\
c3N3b3JkCiAgICAtIG5hbWU6IENVU1RPTV9SRUFMTV9OQU1FCiAgICAgIHJlcXVpcmVkOiBGYWxz\
ZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUgb2YgdGhlIEtleWNsb2FrIHJl\
YWxtIChkZWZhdWx0cyB0byBjdXJyZW50IG5hbWVzcGFjZSkKICAgIC0gbmFtZTogVVNFX1NIQVJF\
RF9TRVJWSUNFCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBib29sCiAgICAgIHRp\
dGxlOiBDb25uZWN0IHRvIGFuIGV4aXN0aW5nIHNoYXJlZCBzZXJ2aWNlCiAgICAtIG5hbWU6IFNI\
QVJFRF9IT1NUCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IFVSTCBvZiB0aGUgc2hhcmVkIHNlcnZpY2UKICAgIGJpbmRfcGFyYW1ldGVyczoKICAg\
IC0gbmFtZTogQ0xJRU5UX05BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgdGl0bGU6IFNl\
cnZpY2UgbmFtZSBvciBDbGllbnQgSUQKICAgICAgdHlwZTogc3RyaW5nCiAgICAtIG5hbWU6IENM\
SUVOVF9UWVBFCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIHRpdGxlOiBLZXljbG9hayBjbGll\
bnQgdHlwZQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnYmVhcmVyJywgJ3B1YmxpYydd\
CiAgICAgIGRlZmF1bHQ6ICdiZWFyZXInCg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb