FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBB\
RVJPR0VBUi0yMzA5CmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOiAKICAtIG1v\
YmlsZS1zZXJ2aWNlCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBLZXljbG9hawogIGltYWdlVXJs\
OiAiaHR0cHM6Ly9wYnMudHdpbWcuY29tL3Byb2ZpbGVfaW1hZ2VzLzcwMjExOTgyMTk3OTM0NDg5\
Ny9vQUMwNWNFQl80MDB4NDAwLnBuZyIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cDovL3d3dy5r\
ZXljbG9hay5vcmcvZG9jdW1lbnRhdGlvbi5odG1sIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczogWydQb3N0Z3Jlc3FsOjkuNSddCiAgc2Vydmlj\
ZU5hbWU6IGtleWNsb2FrCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246\
IERlcGxveSBrZXljbG9hawogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOiAKICAgIC0gbmFtZTogQURNSU5fVVNFUk5BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUK\
ICAgICAgZGVmYXVsdDogYWRtaW4KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXlj\
bG9hayBhZG1pbiB1c2VybmFtZQogICAgLSBuYW1lOiBBRE1JTl9QQVNTV09SRAogICAgICByZXF1\
aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IEtleWNsb2FrIGFkbWluIHBhc3N3b3JkCiAgICAtIG5hbWU6IENVU1RPTV9SRUFMTV9O\
QU1FCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6\
IE5hbWUgb2YgdGhlIEtleWNsb2FrIHJlYWxtIChkZWZhdWx0cyB0byBjdXJyZW50IG5hbWVzcGFj\
ZSkKICAgIC0gbmFtZTogVVNFX1NIQVJFRF9TRVJWSUNFCiAgICAgIHJlcXVpcmVkOiBGYWxzZQog\
ICAgICB0eXBlOiBib29sCiAgICAgIHRpdGxlOiBDb25uZWN0IHRvIGFuIGV4aXN0aW5nIHNoYXJl\
ZCBzZXJ2aWNlCiAgICAtIG5hbWU6IFNIQVJFRF9IT1NUCiAgICAgIHJlcXVpcmVkOiBGYWxzZQog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVSTCBvZiB0aGUgc2hhcmVkIHNlcnZpY2UK\
ICAgIGJpbmRfcGFyYW1ldGVyczoKICAgIC0gbmFtZTogc2VydmljZQogICAgICByZXF1aXJlZDog\
VHJ1ZQogICAgICB0aXRsZTogVGhlIHNlcnZpY2UgdGhlIGNsaWVudCBpcyBmb3IKICAgICAgdHlw\
ZTogc3RyaW5n"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb